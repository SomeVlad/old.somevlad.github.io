webpackJsonp([31569853154523],{"./node_modules/json-loader/index.js!./.cache/json/copy-to-clipboard-execcommand-hell-new.json":function(n,s){n.exports={data:{site:{siteMetadata:{title:"Frontend developer Vlad Samoylov",author:"Vlad Samoylov"}},markdownRemark:{id:"/Users/some_vlad/Desktop/blog/src/pages/2016-12-17-copy-to-clipboard/index.md absPath of file >>> MarkdownRemark",html:'<p>It’s been <a href="https://w3c.github.io/editing/execCommand.html">a while</a> since execCommand() got “Unofficial Draft” status, and it has basic support in Chrome, so it’s already time to test it. (I mean, it’s 2016, right?)  </p>\n<p>This function provides us among other with an ability to put stuff into clipboard with “copy” parameter. So what we <a href="https://developers.google.com/web/updates/2015/04/cut-and-copy-commands">should do</a> step by step in order to make a “copy to clipboard button”:</p>\n<ul>\n<li>Well, make a button and assign a click listener to it</li>\n<li>Have visible node with a text to copy</li>\n<li>Create a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Range">Range object</a></li>\n<li>Call <code>selectNode()</code> function on that range and pass a node we want to copy to it</li>\n<li>Tell browser to get selection</li>\n<li>Ask browser to copy that</li>\n<li>Remove all the selections we created</li>\n</ul>\n<p>That seems pretty simple and should be working <a href="http://caniuse.com/#feat=clipboard">in some browsers</a>. Well, it does. In Firefox 50. </p>\n<p>Safari 10.0.1 can’t execute <code>execCommand()</code>. And at first I haven’t found a workaround.</p>\n<p>Chrome 55 returned a mysterious error: “Discontiguous selection is not supported”. At this point I have no idea why is it discontiguous. But this bug seems to be there <a href="https://groups.google.com/a/chromium.org/forum/#!topic/chromium-bugs/o8yMnFl7LAs">for a long time</a>.  </p>\n<p>So what should we do? Well, if Chrome thinks there is a some kind of “discontiguousness” happening, maybe we should clear all selections first, to tell him there is only one contiguous selection?\nSo I just tried to call this function before all that copying shenanigans start:</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">clearSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>selection<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         document<span class="token punctuation">.</span>selection<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>getSelection<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeAllRanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>And it worked! So the whole “copy to clipboard” logic looks like this:</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code><span class="token keyword">let</span> copyEmailBtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'.copyToClipboardBtn\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ndocument<span class="token punctuation">.</span><span class="token function">queryCommandSupported</span><span class="token punctuation">(</span><span class="token string">\'copy\'</span><span class="token punctuation">)</span> <span class="token operator">?</span>\n    <span class="token punctuation">(</span>copyEmailBtn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'click\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token function">clearSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">let</span> emailLink <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'.emailLink\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">let</span> range <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        range<span class="token punctuation">.</span><span class="token function">selectNode</span><span class="token punctuation">(</span>emailLink<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addRange</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">try</span> <span class="token punctuation">{</span>\n            <span class="token keyword">let</span> successful <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">\'copy\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">let</span> msg <span class="token operator">=</span> successful <span class="token operator">?</span> <span class="token string">\'copied\'</span> <span class="token punctuation">:</span> <span class="token string">\'not_copied\'</span><span class="token punctuation">;</span>\n            copyEmailBtn<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n        <span class="token function">clearSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">:</span> copyEmailBtn<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">\'disabled\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">clearSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>selection<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        document<span class="token punctuation">.</span>selection<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>getSelection<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeAllRanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>Working in Edge, Chrome 55, Firefox 50, and also that fixed Safari 10.0.1’s inability to make <code>execCommand(\'copy\')</code>, so there it’s working to.</p>',frontmatter:{title:"Making cross-browser «copy to&nbsp;clipboard» button",date:"December 17, 2016"}}},pathContext:{path:"/copy-to-clipboard-execcommand-hell-new/"}}}});
//# sourceMappingURL=path---copy-to-clipboard-execcommand-hell-new-34dcc2185e74462139e1.js.map